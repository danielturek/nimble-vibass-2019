---
title: "Automated MCMC comparison"
subtitle: "Valencia International Bayesian Analysis Summer School Workshop"
output:
  html_document:
    toc: yes
    mathjax: default
---



```{r setup, include=FALSE} 
library(methods) ## needed only when building documents outside of R
library(nimble)
library(compareMCMCs)
## library(mcmcplots)
read_chunk('chunks_litters.R')
source("chunks_litters.R")
```

# Automating MCMC comparisons

- A closely related package, `compareMCMCs`, provides tools to automatically compare MCMC efficiency
across methods.
- Methods can include different NIMBLE MCMC configurations as well as
  JAGS
- Later versions of `compareMCMCs` will also support OpenBUGS, WinBUGS, and Stan.

#### Installing `compareMCMCs` package

```{r eval = FALSE}
library(devtools)

devtools::install_github("nimble-dev/compareMCMCs", subdir = "compareMCMCs")
```

#### Overview of `compareMCMCs` package

An introductory overview of using the `compareMCMCs` package is available at:

[https://htmlpreview.github.io/?https://github.com/nimble-dev/compareMCMCs/blob/master/UserManual/compareMCMCs.html](https://htmlpreview.github.io/?https://github.com/nimble-dev/compareMCMCs/blob/master/UserManual/compareMCMCs.html).


# Example: Metropolis-Hastings vs slice sampling. NIMBLE vs. JAGS.

 - `compareMCMCs` provides the `doMCMCs` function for comparing different NIMBLE MCMC algorithms, and also JAGS.
 - A variety of pre-defined NIMBLE MCMC configurations are provided, and also a system for defining your own.
 - I will illustrate using slice samplers instead of the default
Metropolis-Hastings samplers for `a` and `b` in the litters model, and also comparison with JAGS

```{r, prep, echo=FALSE}
# so attendees can run code below this without using code from other modules
# if(!exists('littersModel') || !exists('cLittersModels')) source('chunks_litters.R')
```                   

Here's how we set things up to provide a customized MCMC configuration as one of the comparisons.

```{r, comparisons}
littersInfo <- list(code = littersCode,
                   constants = littersConsts,
                   data = littersData, inits = littersInits)

## A function to configure MCMC with only slice sampling
configure_nimble_slice <- function(model) {
    configureMCMC(model, onlySlice = TRUE)
}
```

# Running `doMCMCs()`

```{r, compareMCMC, eval = FALSE}
littersComparisons <- doMCMCs(
    littersInfo,
    MCMCs = c("jags", "nimble", "nimble_slice"),
    nimbleMCMCdefs = list(nimble_slice = "configure_nimble_slice"),
    MCMCinfo = list(niter = 10000,
                    burnin = 1000))
```



# Viewing the comparisons

```{r, comparison-results, eval=FALSE}
make_MCMC_comparison_pages(littersComparisons,
                           dir = "litters_comparison_results",
                           modelNames = "littersComparisons")
```

The results are [here](litters_comparison_results/littersComparisons.html).

